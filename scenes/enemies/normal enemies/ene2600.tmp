[gd_scene load_steps=4 format=3 uid="uid://clqna6i8r03e"]

[ext_resource type="Texture2D" uid="uid://bo8yknibo4cmq" path="res://sprites/nail.png" id="2_itot5"]

[sub_resource type="GDScript" id="GDScript_ocu5r"]
script/source = "extends CharacterBody2D
class_name enemy

@export var speed = 150
@export var player: Node2D
@export var health = 100
@export var area2d = Area2D
@export var stealth_skill = false

@onready var nav_agent:= $NavigationAgent2D as NavigationAgent2D

func _ready():
	#player = get_node(\"/root/\")
	stealth()
#$player
#movement of enemey is classfied as void
func _physics_process(delta: float) -> void:
	#direction based on navigation agent
	#converts global to local coordinates
	var dir= to_local(nav_agent.get_next_path_position()).normalized()
	velocity = dir*speed
	move_and_slide()
	
func makepath() -> void:
	#check for path only when enemy is not queue_freed
	if is_instance_valid(player):
		nav_agent.target_position = player.global_position
		
func _on_timer_timeout() -> void:
	makepath()

func _on_area_2d_area_entered(area: Area2D) -> void:
	#on entering player node, destroys itself
	print(area.get_parent().name)
	if area.get_parent().name == 'player':
		queue_free()
		
func stealth():
	if stealth_skill:	
		self.modulate.a = 0.3
		#print('adjad')
"

[sub_resource type="CircleShape2D" id="CircleShape2D_f3jqi"]
radius = 31.0161

[node name="enemy" type="CharacterBody2D" node_paths=PackedStringArray("area2d") groups=["enemy"]]
collision_mask = 134
motion_mode = 1
wall_min_slide_angle = 0.0
script = SubResource("GDScript_ocu5r")
area2d = NodePath("Area2D")

[node name="Area2D" type="Area2D" parent="."]
collision_layer = 0
collision_mask = 0

[node name="CollisionShape2D" type="CollisionShape2D" parent="Area2D"]
shape = SubResource("CircleShape2D_f3jqi")

[node name="Sprite2D" type="Sprite2D" parent="."]
modulate = Color(0.756863, 0.380392, 0.141176, 1)
position = Vector2(6, 10)
scale = Vector2(2, 2)
texture = ExtResource("2_itot5")

[node name="NavigationAgent2D" type="NavigationAgent2D" parent="."]
navigation_layers = 3
avoidance_enabled = true
avoidance_layers = 3
avoidance_mask = 3
debug_enabled = true

[node name="Timer" type="Timer" parent="."]
wait_time = 0.1
autostart = true

[node name="CollisionShape2D" type="CollisionShape2D" parent="."]
shape = SubResource("CircleShape2D_f3jqi")

[connection signal="area_entered" from="Area2D" to="." method="_on_area_2d_area_entered"]
[connection signal="timeout" from="Timer" to="." method="_on_timer_timeout"]
